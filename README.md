# YaleSites Upstreams

YaleSites uses a hierarchy of Pantheon upstreams to deliver a consistent set of features and configurations to each tier of service. The upstreams act as custom scaffolding for Drupal sites. While the majority of sites exist on the platform, multiple upstreams are used to provide a path for extending the platform to meet specific business needs.

* *Base upstream*: The base upstream defines base functionality for all sites that are a part of the YaleSites ecosystem. This includes a majority of site configuration, modules, theme integrations, and tooling.
* *Platform upstream (fork of base)*: A separate platform upstream contains any code that is particular to sites on the YaleSites platform (lowest tier) but should not be included on vendor-supported sites. Sites on the platform upstream will use the integrated composer workflow and will pull in build artifacts for the themes.
* *Vendor supported upstream (fork of base)*: A separate upstream contains code specific to vendor-supported sites. It is possible that this upstream mirrors the base upstream but will still exist for unknown future needs.

## Upstream architecture

This project follows the authoritative [drupal-recommended](https://github.com/pantheon-upstreams/drupal-recommended) repository managed by Pantheon. Updates to Pantheon scaffolding and Drupal Core may be pulled from this remote. Pantheon's [integrated composer](https://pantheon.io/docs/integrated-composer) is employed as part of a one-click continuous integration strategy.

Files and directories important to the structure of the upstream include:

```
└─ config/
└─ upstream-configuration/
   └─ composer.json
└─ web/sites/default
   └─ settings.php
├─ .gitignore
├─ composer.json
├─ pantheon.upstream.yml
└─ README.md
```

* `config/`: Not currently in use on this project.
* `upstream-configuration/composer.json`: The two different composer.json files allow customization of individual sites without inherent merge conflicts and enable one-click updates. Platform-wide dependencies, such as the yalesites_profile are included in this file.
* `web/sites/default/settings.php`: Boilerplate for the site-specific settings file.
* `.gitignore`: Prevents build artifacts generated by Composer from being committed to the upstream or site code repositories.
* `composer.json`: The composer file at the project root is for project settings and scaffolding. Vendor-supported sites or sites with emergent features may add dependencies or customizations here. Developers should avoid updating this file in the upstream.
* `pantheon.upstream.yml`: The build_step: true directive in pantheon.upstream.yml enables the build step.
* `README.md`: You are [here](#).

## Local Development Environment

This project supports development with Lando using the Pantheon recipe. Most local tooling, including Composer, Drush, Drupal console, and node applications are available through this recipe.

### Requirements

* [Composer](https://getcomposer.org/download/): PHP package manager. Version 2.x.
* [Terminus](https://pantheon.io/docs/terminus): Pantheon CLI.
* [Docker](https://docs.docker.com/install): Container system for virtualization.
* [Lando](https://docs.lando.dev/basics/installation.html#system-requirements): Recipes and tools for Docker.

### Setup
* [Lando CA](https://docs.devwithlando.io/config/security.html): Optional certificate authority setup.
* Public key for your machine uploaded to Pantheon.
* Copy `.lando.local.example.yml` to `.lando.local.yml` and set the Pantheon environmental variables for the site you wish to work on.
* Run `lando start`
* Run `lando pull`

id: ys_paragraph_accordion
label: YS Paragraph Accordion
description: Migration of accordion
source_type: 'JSON file from URL'

source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: json
  urls:
    - profiles/custom/yalesites_profile/modules/custom/ys_demo_migration/content/paragraph_accordion.json
  item_selector: /data/paragraph_accordion
  fields:
    - name: paragraph_id
      label: 'Paragraph ID'
      selector: paragraph_id
    - name: paragraph_type
      label: 'Paragraph type'
      selector: paragraph_type

    - name: field_accordion_heading_value
      label: 'Heading value'
      selector: paragraph_fields/field_heading/value
    - name: field_accordion_heading_format
      label: 'Heading format'
      selector: paragraph_fields/field_heading/format

    - name: field_accordion_item
      label: 'Accordion item'
      selector: paragraph_fields/field_accordion_item

  ids:
    paragraph_id:
      type: string

process:

  field_heading/value: field_accordion_heading_value
  field_heading/format: field_accordion_heading_format

  field_accordion_item:
      -
        plugin: skip_on_empty
        source: field_accordion_item
        method: process
        message: 'Field field_accordion_item is empty'
      -
        plugin: multiple_values
        source: field_accordion_item
      -
        plugin: migration_lookup
        migration: ys_paragraph_accordion_field_content
        no_stub: false
      -
        plugin: sub_process
        process:
          target_id: '0'
          target_revision_id: '1'

  type: paragraph_type

destination:
  plugin: entity_reference_revisions:paragraph

migration_dependencies:
  required:
    - ys_paragraph_accordion_item
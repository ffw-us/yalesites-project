
id: ys_pages
label: YS Pages
description: Migration of pages to Drupal
source_type: 'custom embedded data'

source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: json
  urls:
    - profiles/custom/yalesites_profile/modules/custom/ys_demo_migration/content/pages.json
  item_selector: /data/pages
  fields:
    - 
      name: src_unique_id
      label: 'Unique ID'
      selector: unique_id
    - 
      name: src_name
      label: 'Name'
      selector: name
    -
      name: paragraph_ref
      label: 'Paragraph Ref'
      selector: paragraph_ref

  ids:
    src_unique_id:
      type: string

dependencies:
  enforced:
    module:
      - ys_demo_migration

process:
  uid:
    plugin: default_value
    default_value: 1

  status:
    plugin: default_value
    default_value: true

  title: src_name

  # Paragraphs.
  paragraph_text:
    -
      plugin: migration_lookup
      migration: ys_paragraphs
      source: paragraph_ref
    -
      plugin: null_as_array

  # paragraph_gallery:
  #   -
  #     plugin: migration_lookup
  #     migration: articles_paragraphs_gallery
  #     source: id
  #   -
  #     plugin: null_as_array

  field_content:
      plugin: sub_process
      source:
        - '@paragraph_text'
        # - '@paragraph_gallery'
      process:
        target_id:
           -
             plugin: skip_on_empty
             method: process
             message: 'Cannot import empty paragraph'
             source: '0'
        target_revision_id:
           -
             plugin: skip_on_empty
             method: process
             message: 'Cannot import empty paragraph'
             source: '1'

destination:
  plugin: entity:node
  default_bundle: page

migration_dependencies:
  required:
    - ys_paragraphs
    # - articles_paragraphs_gallery
# Getting started as a developer

## Updating Drupal configuration

Drupal's configuration management system organizes information about the structure and settings of the application into a consistent collection of structured data. Active configurations are typically stored in the site's database while staged configurations are stored in a series of YAML files. DevOps and version control tools will track changes to the YAML files to deploy configuration changes across different websites and environments. Changes made in a local development environment can be tested and released to the production website predictably.

Configuration in Drupal refers to many parts of the website including content types, vocabularies, field definitions, roles, permissions, WYSIWYG settings, media types, and views, among many other things. Instances of content (nodes, terms, users) and state variables are not considered configuration and will not be stored in version control.

### Platform settings

All platform config files are stored in the [yalesites_profile](https://github.com/yalesites-org/yalesites_profile) installation profile. YAML files are stored in the `config/sync` directory. This is a new approach to maintaining configuration without the need to edit file contents like the UUID. The project's settings.php ensures all sites use the profile configuration as the canonical source of site settings.

### Process for updating

All configuration changes must be tracked in the profile repository. This includes changes to content types, fields, and module settings, among others. After making changes:

```bash
# Export configuration to update local YAML files.
lando drush cex -y
# Navigate to the profile and review changes.
cd web/profiles/contrib/yalesites_profile && git status
# If all looks well, then add and commit the set of configs.
git add config/sync
```

### Best practices:

1. Avoid making changes in production. Configuration should get created in a local development environment, exported, checked into the profile repository, and move through the development workflow.
2. Avoid making manual changes to YAML files. The configuration files include many interdependencies and should be generated by Drupal as a complete set. All files should move through version control together.
3. Export configuration regularly. Updating modules, adding custom code, and even interacting with seemingly unrelated admin forms can create changes in the active configuration. Check-in these changes regularly to ensure all sites stay in sync.

## Creating a custom module

Custom functionality is added to the platform through Yale maintained modules. If the code is dependant on the architecture defined in the installation profile, then a custom module should be added directly to the yalesites_profile repo. If the work is not inherently tied to YaleSites or if the code has value to other sites that are not on the platform, then the module can be created in a separate repository and added as contributed code.

```bash
# Navigate to the custom modules directory
cd web/profiles/contrib/yalesites_profile/modules/custom
# Custom modules are added directly to the profile repo.
```

## Installing a contrib module

Contributed modules extend the functionality of Drupal to add new features or alter existing functionality. Modules are added to the installation profile and pushed out to all sites on the platform. When developing locally, adding a module to the profile will not automatically rebuild the composer installed dependencies in the parent project. The following process may be followed when installing a contributed module in a local development environment.

```bash
# Navigate to the installation profile repository.
cd web/profiles/contrib/yalesites_profile
# Require the new module without downloading packages in this folder.
lando composer require drupal/PROJECT --no-update
# Navigate to the project root.
cd ../../..
# Remove the lock file to force composer to fetch dependency changes.
rm composer.lock
# Update the installation profile.
lando composer update yalesites_profile
```

## Updating a YaleSites theme

Contributed themes are added to the YaleSites platform as dependencies of the installation profile. Developers can make changes to the theme files directly.

```bash
# Navigate to the theme folder and update files ad needed.
cd web/themes/contrib/atomic
# Theme changes are committed in the theme's repository.
```

Frontend tasks may often require changes to the site's fields, content types, or displays. If this is the case, then developers can follow the above process for updating site configuration. These config settings are tracked in the yalesites_profile repository. A process has not yet been defined for deploying config changes and theme changes into the same multidev environment.
